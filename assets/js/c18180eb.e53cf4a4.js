"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[1680],{3905:(e,t,i)=>{i.d(t,{Zo:()=>u,kt:()=>m});var a=i(7294);function n(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function r(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,a)}return i}function o(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?r(Object(i),!0).forEach((function(t){n(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):r(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}function s(e,t){if(null==e)return{};var i,a,n=function(e,t){if(null==e)return{};var i,a,n={},r=Object.keys(e);for(a=0;a<r.length;a++)i=r[a],t.indexOf(i)>=0||(n[i]=e[i]);return n}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(a=0;a<r.length;a++)i=r[a],t.indexOf(i)>=0||Object.prototype.propertyIsEnumerable.call(e,i)&&(n[i]=e[i])}return n}var c=a.createContext({}),l=function(e){var t=a.useContext(c),i=t;return e&&(i="function"==typeof e?e(t):o(o({},t),e)),i},u=function(e){var t=l(e.components);return a.createElement(c.Provider,{value:t},e.children)},d="mdxType",p={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},h=a.forwardRef((function(e,t){var i=e.components,n=e.mdxType,r=e.originalType,c=e.parentName,u=s(e,["components","mdxType","originalType","parentName"]),d=l(i),h=n,m=d["".concat(c,".").concat(h)]||d[h]||p[h]||r;return i?a.createElement(m,o(o({ref:t},u),{},{components:i})):a.createElement(m,o({ref:t},u))}));function m(e,t){var i=arguments,n=t&&t.mdxType;if("string"==typeof e||n){var r=i.length,o=new Array(r);o[0]=h;var s={};for(var c in t)hasOwnProperty.call(t,c)&&(s[c]=t[c]);s.originalType=e,s[d]="string"==typeof e?e:n,o[1]=s;for(var l=2;l<r;l++)o[l]=i[l];return a.createElement.apply(null,o)}return a.createElement.apply(null,i)}h.displayName="MDXCreateElement"},8961:(e,t,i)=>{i.r(t),i.d(t,{assets:()=>c,contentTitle:()=>o,default:()=>p,frontMatter:()=>r,metadata:()=>s,toc:()=>l});var a=i(7462),n=(i(7294),i(3905));const r={id:"exchange",title:"Deployment Task - Deploy To Microsoft Exchange"},o=void 0,s={unversionedId:"deployment/tasks/exchange",id:"deployment/tasks/exchange",title:"Deployment Task - Deploy To Microsoft Exchange",description:"Requesting a certificate for Microsoft Exchange",source:"@site/docs/deployment/tasks/exchange.md",sourceDirName:"deployment/tasks",slug:"/deployment/tasks/exchange",permalink:"/docs/deployment/tasks/exchange",draft:!1,editUrl:"https://github.com/webprofusion/certify-docs/edit/master/docs/deployment/tasks/exchange.md",tags:[],version:"current",frontMatter:{id:"exchange",title:"Deployment Task - Deploy To Microsoft Exchange"}},c={},l=[{value:"Requesting a certificate for Microsoft Exchange",id:"requesting-a-certificate-for-microsoft-exchange",level:2},{value:"Certificate Requirements",id:"certificate-requirements",level:2},{value:"Requesting your Certificate",id:"requesting-your-certificate",level:2},{value:"Deploying Your Certificate to Exchanges Services",id:"deploying-your-certificate-to-exchanges-services",level:2},{value:"Renewal Failures",id:"renewal-failures",level:2},{value:"General Considerations",id:"general-considerations",level:2},{value:"Things to avoid",id:"things-to-avoid",level:3},{value:"Only use valid fully qualified domain names (or valid wildcard names)",id:"only-use-valid-fully-qualified-domain-names-or-valid-wildcard-names",level:3},{value:"IP Address Bindings vs SNI Hostname Bindings",id:"ip-address-bindings-vs-sni-hostname-bindings",level:3},{value:"Alternative Tools",id:"alternative-tools",level:2},{value:"Other resources",id:"other-resources",level:2}],u={toc:l},d="wrapper";function p(e){let{components:t,...i}=e;return(0,n.kt)(d,(0,a.Z)({},u,i,{components:t,mdxType:"MDXLayout"}),(0,n.kt)("h2",{id:"requesting-a-certificate-for-microsoft-exchange"},"Requesting a certificate for Microsoft Exchange"),(0,n.kt)("p",null,"Certify The Web can be used to request and install certificates for use with Microsoft Exchange. The process is similar to requesting a certificate for IIS, however there are some additional considerations for Exchange. "),(0,n.kt)("p",null,"The first part of the process is acquiring the appropriate certificate from a certificate authority (CA) and the second part is deploying the certificate on your Exchange services."),(0,n.kt)("admonition",{type:"warning"},(0,n.kt)("p",{parentName:"admonition"},"This guide assumes you are already familiar with administering Microsoft Exchange. If you are not familiar with administering Exchange you should seek assistance from a qualified Exchange administrator. Exchange is generally part of your business critical infrastructure and if it is being administered by non-qualified staff you are actively risking your production system."),(0,n.kt)("p",{parentName:"admonition"},"Practising on a test server is strongly recommended before making changes to your production environment.")),(0,n.kt)("h2",{id:"certificate-requirements"},"Certificate Requirements"),(0,n.kt)("p",null,"The single most important thing to get right for a certificate is for it to include the correct names corresponding to the services you will associate the certificate with and which your end users etc will access. For instance if your company domain was ",(0,n.kt)("inlineCode",{parentName:"p"},"contoso.com")," then ",(0,n.kt)("inlineCode",{parentName:"p"},"mail.contoso.com"),", ",(0,n.kt)("inlineCode",{parentName:"p"},"webmail.contoso.com")," and ",(0,n.kt)("inlineCode",{parentName:"p"},"autodiscover.contoso.com")," might all be necessary to include on one certificate, depending on your requirements. "),(0,n.kt)("p",null,"You cannot include local intranet names such as just ",(0,n.kt)("inlineCode",{parentName:"p"},"webmail")," on a publicly trusted certificate, because you simply do not control that generic name globally and cannot prove that you do so to a public certificate authority. That means you can't just use local intranet names for your services at all including ",(0,n.kt)("inlineCode",{parentName:"p"},"localhost")," or ",(0,n.kt)("inlineCode",{parentName:"p"},".local")," names."),(0,n.kt)("p",null,"While a certificate can technically be associated (bound) to a service ",(0,n.kt)("em",{parentName:"p"},"without")," matching the name (e.g. you can try to access your service using ",(0,n.kt)("inlineCode",{parentName:"p"},"https://localhost"),") standard browsers and software will not trust the certificate if the name you are trying to access does not match and will display a warning to the user or simply refuse to connect."),(0,n.kt)("h2",{id:"requesting-your-certificate"},"Requesting your Certificate"),(0,n.kt)("p",null,"Add your required domains to your certificate, for instance ",(0,n.kt)("inlineCode",{parentName:"p"},"mail.contoso.com")," and ",(0,n.kt)("inlineCode",{parentName:"p"},"autodiscover.contoso.com")," and then request your certificate from your chosen CA. If you prefer to use a wildcard name such as ",(0,n.kt)("inlineCode",{parentName:"p"},"*.contoso.com")," then you can use that instead of specifying individual names. There are additional validation considerations for wildcard certificates."),(0,n.kt)("p",null,"To request a certificate, you can follow the standard ",(0,n.kt)("a",{parentName:"p",href:"/docs/certificate-process"},"certificate request process"),". "),(0,n.kt)("p",null,"As a summary that process is:"),(0,n.kt)("p",null,"In Certify The Web, running on the same server where Exchange is installed:"),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},"Select ",(0,n.kt)("em",{parentName:"li"},"New Certificate")),(0,n.kt)("li",{parentName:"ul"},"Add your required domains to your certificate, for instance ",(0,n.kt)("inlineCode",{parentName:"li"},"mail.contoso.com")," and ",(0,n.kt)("inlineCode",{parentName:"li"},"autodiscover.example.com")),(0,n.kt)("li",{parentName:"ul"},"On the ",(0,n.kt)("em",{parentName:"li"},"Authorization")," tab, confirm how you will complete the domain validation process (DNS or HTTP). Http validation is the default and is usually the easiest to complete. For http validation to work all names on your certificate must resolve to the server where you are running Certify The Web and TCP port 80 must be open."),(0,n.kt)("li",{parentName:"ul"},"Click ",(0,n.kt)("em",{parentName:"li"},"Test"),' to check basic configuration and connectivity, then click "Request Certificate" to begin the certificate request process.'),(0,n.kt)("li",{parentName:"ul"},"If your certificate request is successful the certificate will now be stored in the local machine certificate store and you can proceed to configuring Deployment Tasks to install the certificate on your Exchange server.")),(0,n.kt)("p",null,"Other topics to consider include selecting between different Certificate Authorities, Private Key types and PFX password protection. These options are all configured under ",(0,n.kt)("em",{parentName:"p"},"Advanced"),"."),(0,n.kt)("h2",{id:"deploying-your-certificate-to-exchanges-services"},"Deploying Your Certificate to Exchanges Services"),(0,n.kt)("p",null,"Once you have your certificate you can automate deploying it to your Exchange services. "),(0,n.kt)("admonition",{type:"info"},(0,n.kt)("p",{parentName:"admonition"},"To begin on a new Exchange install, start by assigning the new certificate to services in Exchange, this enables https for web services and TLS for mail services. You can do this using the Exchange Admin Center or the Exchange Management Shell. For more information see ",(0,n.kt)("a",{parentName:"p",href:"https://docs.microsoft.com/en-us/exchange/architecture/client-access/assign-certificates-to-services?view=exchserver-2019"},"Assign a certificate to Exchange services"),"."),(0,n.kt)("p",{parentName:"admonition"},"Open Exchange Admin Center (EAC). Select ",(0,n.kt)("em",{parentName:"p"},"servers")," on the left pane and navigate to ",(0,n.kt)("em",{parentName:"p"},"certificates")," to administer certificate for each service.")),(0,n.kt)("p",null,'The Certify The Web app provides a basic built in deployment task called "Deploy To Microsoft Exchange" which uses a small powershell script to apply the certificate. ',(0,n.kt)("a",{parentName:"p",href:"https://github.com/webprofusion/certify-plugins/blob/development/src/DeploymentTasks/Core/Providers/Assets/Exchange.ps1"},"The script used")," is also available in the Certify The Web source code repository."),(0,n.kt)("p",null,"In Certify The Web, select your managed certificate:"),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},"On the ",(0,n.kt)("em",{parentName:"li"},"Tasks tab"),", under ",(0,n.kt)("em",{parentName:"li"},"Deployment Tasks"),", select Add Task > Deploy To Microsoft Exchange. "),(0,n.kt)("li",{parentName:"ul"},"Under ",(0,n.kt)("em",{parentName:"li"},"Task Parameters")," the list of services the certificate will be applied to are listed e.g. ",(0,n.kt)("inlineCode",{parentName:"li"},"POP,IMAP,SMTP,IIS"),". You can optionally edit this list to include only the services you require."),(0,n.kt)("li",{parentName:"ul"},"Save the updated managed certificates settings, then you can try out the Deployment Task by clicking the run button \u25b6\ufe0f next to the task."),(0,n.kt)("li",{parentName:"ul"},"When the certificate next automatically renews, this deployment task will also run.")),(0,n.kt)("p",null,"For complex or customised deployments you may wish to use a ",(0,n.kt)("a",{parentName:"p",href:"/docs/script-hooks"},"custom deployment script"),"."),(0,n.kt)("p",null,"It's possible to continue to apply the certificate manually using the standard Exchange Admin Center features, however this is not recommended because certificates typically renew frequently (e.g. within 90 days) and you would need to remember to repeat the process each time. You should instead use automation to ensure your certificates are always up to date."),(0,n.kt)("h2",{id:"renewal-failures"},"Renewal Failures"),(0,n.kt)("p",null,"Certificate can fail to renew for a number of reasons, including:"),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},"Changes to your infrastructure (e.g. firewall changes, DNS changes)"),(0,n.kt)("li",{parentName:"ul"},"Temporary issues with your CA")),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"The app will recover from temporary issues automatically"),", however if you have made changes to your infrastructure you may need to update your managed certificate settings to reflect the new configuration. You can force a certificate renewal attempt by selecting ",(0,n.kt)("em",{parentName:"p"},"Request Certificate"),"."),(0,n.kt)("p",null,"By default, ",(0,n.kt)("strong",{parentName:"p"},"if your certificate renewal fails repeatedly, you will receive an email notification"),". This email is trigger by the default status reporting to our API, which in turn sends an email via SendGrid if multiple failures have been detected. The email address used is the one you specified when you first setup your CA account in the application (under Settings > Certificate Authorities). You can also check the Certify The Web app or the ",(0,n.kt)("a",{parentName:"p",href:"https://certifytheweb.com"},"https://certifytheweb.com")," dashboard (if enabled) for the status of your managed certificates."),(0,n.kt)("p",null,"If you don't understand why a renewal has suddenly failed it's best not to start changing settings if you are unsure, instead please ",(0,n.kt)("a",{parentName:"p",href:"/docs/support"},"contact us for support")," if you are a licensed user, or post a question on our ",(0,n.kt)("a",{parentName:"p",href:"https://community.certifytheweb.com"},"community forum"),", ideally including your managed certificate log file, at the least we need your real domain name(s) in order to diagnose common renewal failures. "),(0,n.kt)("p",null,"Typical troubleshoot steps include checking your firewall (if using http validation TCP port 80 must be open and reachable, the app itself requires outgoing https access for APIs) and domain/DNS settings and restarting the server."),(0,n.kt)("h2",{id:"general-considerations"},"General Considerations"),(0,n.kt)("p",null,"Things to consider when administering certificates for exchange and IIS:"),(0,n.kt)("h3",{id:"things-to-avoid"},"Things to avoid"),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},"Never delete a certificate from the certificate store while it is still in use by a service, this will break the service and you will need to re-assign a new certificate to the service. Certify The Web will maintain it's own certificates in the store and by default will remove them when they are definitely no longer required."),(0,n.kt)("li",{parentName:"ul"},"Never revoke a certificate unless the private key has been compromised. Revoking a certificate will break any services using that certificate and is almost never required.")),(0,n.kt)("h3",{id:"only-use-valid-fully-qualified-domain-names-or-valid-wildcard-names"},"Only use valid fully qualified domain names (or valid wildcard names)"),(0,n.kt)("p",null,"Certificates need to be issued for valid fully qualified names or wildcards. A certificate can cover multiple hostnames or subdomains and can also be wildcards that cover all subdomains of a domain e.g. ",(0,n.kt)("inlineCode",{parentName:"p"},"*.contoso.com")," would cover ",(0,n.kt)("inlineCode",{parentName:"p"},"mail.contoso.com")," and ",(0,n.kt)("inlineCode",{parentName:"p"},"autodiscover.contoso.com")," but not ",(0,n.kt)("inlineCode",{parentName:"p"},"mail.contoso.com.au")," or ",(0,n.kt)("inlineCode",{parentName:"p"},"mail.contoso.local"),"."),(0,n.kt)("p",null,"If your exchange services and connections are configured to use local or intranet names like ",(0,n.kt)("inlineCode",{parentName:"p"},"localhost")," or ",(0,n.kt)("inlineCode",{parentName:"p"},"mail.contoso.local")," then the service will not have a valid TLS connection to the server and will not be able to use the certificate, this is because the name is not included in the certificate your are trying to use. You will need to ensure that all services and connections use valid hostnames which match your certificate(s)."),(0,n.kt)("h3",{id:"ip-address-bindings-vs-sni-hostname-bindings"},"IP Address Bindings vs SNI Hostname Bindings"),(0,n.kt)("p",null,'If you manually create an https "binding" (the configuration of an IP address or hostname + socket + certificate) then you should enable SNI (Server Name Indication), set a hostname and avoid using specific IP addresses, instead use ',(0,n.kt)("inlineCode",{parentName:"p"},"All Unassigned")," or ",(0,n.kt)("inlineCode",{parentName:"p"},"*")," in IIS etc. This maps to the catch-all address ",(0,n.kt)("inlineCode",{parentName:"p"},"0.0.0.0")," and matches the binding to all network interfaces."),(0,n.kt)("p",null,"If you use a specific IP address in your binding you are constraining how the certificate can be applied to requests and you are also overriding other less specific bindings on the same IP address. This can cause ",(0,n.kt)("a",{parentName:"p",href:"/docs/guides/ssl-windows"},"binding conflict problems")," if you have multiple certificates on the same IP address."),(0,n.kt)("h2",{id:"alternative-tools"},"Alternative Tools"),(0,n.kt)("p",null,"Other ACME clients are available on Windows and in some cases administrators looking after Exchange may prefer to use a different client. Certify The Web has an extensive feature set aimed at managing a large number of certificates and it may be more than you really need for a single Exchange deployment. "),(0,n.kt)("p",null,"Some other clients to consider for very specific tasks include ",(0,n.kt)("a",{parentName:"p",href:"https://github.com/rmbolger/Posh-ACME"},"Posh-ACME (PowerShell)")," and ",(0,n.kt)("a",{parentName:"p",href:"https://github.com/win-acme/win-acme"},"win-acme (WACS - command line)"),". Both of these are well maintained projects which we (Certify The Web) also sponsor on Github."),(0,n.kt)("h2",{id:"other-resources"},"Other resources"),(0,n.kt)("p",null,"Details of the general processes begin importing and installing a certificate for Exchange can be found here:"),(0,n.kt)("p",null,(0,n.kt)("a",{parentName:"p",href:"https://learn.microsoft.com/en-us/exchange/architecture/client-access/import-certificates?view=exchserver-2019"},"https://learn.microsoft.com/en-us/exchange/architecture/client-access/import-certificates?view=exchserver-2019")),(0,n.kt)("p",null,"Assign certificates to services:"),(0,n.kt)("p",null,(0,n.kt)("a",{parentName:"p",href:"https://learn.microsoft.com/en-us/exchange/architecture/client-access/assign-certificates-to-services?view=exchserver-2019"},"https://learn.microsoft.com/en-us/exchange/architecture/client-access/assign-certificates-to-services?view=exchserver-2019")),(0,n.kt)("p",null,"Details of the certificate requirements for Exchange services can be found here:"),(0,n.kt)("p",null,(0,n.kt)("a",{parentName:"p",href:"https://learn.microsoft.com/en-us/exchange/architecture/client-access/certificates?view=exchserver-2019#certificate-requirements-for-exchange-services"},"https://learn.microsoft.com/en-us/exchange/architecture/client-access/certificates?view=exchserver-2019#certificate-requirements-for-exchange-services")),(0,n.kt)("p",null,"Check Exchange Remote Connectivity:"),(0,n.kt)("p",null,(0,n.kt)("a",{parentName:"p",href:"https://testconnectivity.microsoft.com/tests/exchange"},"https://testconnectivity.microsoft.com/tests/exchange")))}p.isMDXComponent=!0}}]);